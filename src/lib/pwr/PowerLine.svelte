<script lang='ts'>
import { onMount} from 'svelte';
import AssetComp from '../asset/AssetComp.svelte';
import {Asset} from '../asset/asset'
import D3Libre from '../d3/D3Libre.svelte'


onMount(async () => {
	buildAssetFromCoords(rdp_udsud)
    // force re-rendering
    assets = [...assets]
})

let map:any = null
let assets = []
let structures = ['Redipuglia-UDsud','Struttura 2','Struttura 3']
let containerClass = 'map-container'

let rdp_udsud = [
	[13.471033574202934, 45.85175337043916, 200],
	[13.46887710880064, 45.85166383155799, 200],
	[13.464776641631351, 45.85232698092819, 200],
	[13.460000923650009, 45.85315269243209, 200],
    [13.455210296215855, 45.85241464295666, 200],
    [13.450542801534054, 45.85231740018976, 200],
    [13.44505195689818, 45.85224297923758, 200],
    [13.440372959758156, 45.85264705377735, 200],
    [13.43491566711406, 45.853145201118316, 200],
    [13.430552649969458, 45.85374031215768, 200],
    [13.427054412283702, 45.85425048747848, 200],
    [13.42180239528584, 45.85469186472455, 200],
    [13.421753083471454, 45.85477640549971, 200],
    [13.42049752877672, 45.856784211169646, 200],
    [13.419075072517051, 45.85909838146707, 200],
    [13.417231569217059, 45.86211775336656, 200],
    [13.414944259553529, 45.86584485333895, 200],
    [13.412842256462007, 45.86940123416414, 200],
    [13.410700121573068, 45.872928602028615, 200],
    [13.409024382824242, 45.87626183308792, 200],
    [13.407730604141983, 45.879269523343716, 200],
    [13.405790138711938, 45.883102613795984, 200],
    [13.404673390576106, 45.88535190067511, 200],
    [13.401449156409143, 45.88716849668964, 200],
	[13.397964200555625, 45.889176883277486, 200],
	[13.393997700459533, 45.89144838751932, 200],
	[13.390497942214385, 45.8941214339159, 200],
    [13.387071330745606, 45.896817549729164, 200],
    [13.383708066508717, 45.899508680937736, 200],
    [13.380488647981107, 45.90207119265619, 200],
    [13.377430534947708, 45.904495986850016, 200],
    [13.374393238607812, 45.90689393176899, 200],
    [13.371921326740082, 45.90885788036059, 200],
    [13.368830462308601, 45.91130921261307, 200],
    [13.365567464319943, 45.91382065050609, 200],
    [13.362734735836513, 45.914786797388075, 200],
    [13.358106067172415, 45.91618069663717, 200],
    [13.355244373386684, 45.917071419328344, 200],
    [13.35189875631175, 45.918063650495355, 200],
    [13.347889485540682, 45.919268640789234, 200],
    [13.343076806040843, 45.91965574702892, 200],
    [13.338048063988897, 45.920019261652214, 200],
    [13.332570960307958, 45.920426599116404, 200],
    [13.327696565621824, 45.920785249222355, 200],
    [13.32323639294551, 45.92113773632758, 200],
    [13.319594100618815, 45.92387639472775, 200],
    [13.315751587018477, 45.92683995804946, 200],
	[13.312192114997028, 45.929493474069304, 200],
	[13.310873017679514, 45.93216340236006, 200]
	]

    const buildAssetFromCoords = (coords: number[][]) => {
	for(let i = 0; i < coords.length; i++){
		const asset = new Asset(coords[i],null);
		if(i%5 == 0)
			asset.setUserData({id:'Asset_'+i,status:'WARNING'});
		else if(i%7 == 0)
			asset.setUserData({id:'Asset_'+i,status:'ALARM'});
		else 
			asset.setUserData({id:'Asset_'+i,status:'NORMAL'});
        if(i == 0 || i == coords.length-1){
		    asset.addField('descriprion','stazione trasformazione')
            asset.addField('type','trasformator')
        }else{
			asset.addField('descriprion','linea elettrica')
			asset.addField('type','traliccio')}
		assets.push(asset);
	}
	console.log(assets)
	// forza il re-rendering
	assets = [...assets]
}
</script>
 <div class="asset-manager">
	<D3Libre bind:map={map} {containerClass} bind:assets={assets}/>
	<AssetComp mapClass={containerClass} bind:assets={assets} {structures}/>
</div>
<style>
.asset-manager {
	display: flex;
	flex-direction: row;
}
</style>